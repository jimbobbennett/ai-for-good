<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>LAB GUIDE – includes</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://opsgilitylabs.blob.core.windows.net/lablayout/labstyles.css"></link>
</head>
<body>
<h2 id="exercise-5-visualizing-data-with-power-bi">Exercise 5: Visualizing Data with Power BI</h2>
<p>The goal of business intelligence is being able to quickly identify and respond to ever-changing trends in business and industry. Whether you’re a data analyst delivering reports and analytics to your organization or a stakeholder or decision-maker in need of critical insights, Power BI can organize and unify all of your organization’s data to provide a clear view of the world around you.</p>
<p><a href="https://powerbi.microsoft.com">Microsoft Power BI</a> was created to address the data explosion in commercial and academic organizations, the need to analyze that data, and the need for rich, interactive visuals to represent the data and reveal key insights. It contains a suite of tools that assist in data analysis, from data discovery and collection to data transformation, aggregation, sharing, and collaboration. Moreover, it allows you to create rich visualizations and package them in interactive dashboards.</p>
<p>In this exercise, you will connect Microsoft Power BI to the Azure SQL database you created in the previous exercise to capture information emanating from the virtual camera array you deployed in the Arctic. Then you will use Power BI to build a report that shows in near real-time where polar bears are being spotted.</p>
<p><img src="images/road-map-4.png" /></p>
<h3 id="objectives">Objectives</h3>
<p>In this exercise, you will learn how to:</p>
<ul>
<li>Connect Power BI to an Azure SQL database</li>
<li>Use Power BI to visualize data written to the database</li>
<li>Create a report that can be shared with colleagues</li>
</ul>
<h3 id="time-estimate">Time Estimate</h3>
<ul>
<li>30 minutes</li>
</ul>
<h2 id="task-1-connect-power-bi-to-azure-sql">Task 1: Connect Power BI to Azure SQL</h2>
<p>In the previous exercise, you used the <a href="https://azure.microsoft.com/services/cognitive-services/custom-vision-service/">Custom Vision Service</a> to train an image-classification model to differentiate between different types of Arctic wildlife, and modified the Azure Function you wrote to output the results to an Azure SQL database. The first step in using Microsoft Power BI to explore and visualize this data is connecting it to Power BI as a data source. In this task, you will connect Power BI to the Azure SQL database.</p>
<ol type="1">
<li><p>From your LABVM, launch Power BI Desktop.</p></li>
<li><p>On the Welcome to Power BI Desktop dialogue, click <strong>Already have a Power BI account? Sign in</strong>.</p>
<p><img src="images/2019-10-20-20-01-26.png" /></p></li>
<li><p>Sign in with your Azure credentials in the cloud icon. If you receive a <strong>Sign up for Power BI</strong> prompt, click the <strong>x</strong>.</p>
<p><img src="images/2019-10-20-20-03-08.png" /></p></li>
<li><p>On the Power BI Desktop dialogue, click <strong>Get data</strong>.</p>
<p><img src="images/2019-10-20-20-08-13.png" /></p></li>
<li><p>On the Get Data dialogue, select <strong>Azure</strong>, select <strong>Azure SQL database</strong> and then click <strong>Connect</strong>.</p>
<p><img src="images/2019-10-20-20-12-09.png" /></p></li>
<li><p>Enter the server’s host name (the server name plus “.database.windows.net” since it’s an Azure SQL database server that can be found in the Portal) and <strong>PolarBearDB</strong> for the database name. Select <strong>DirectQuery</strong> for the connectivity mode. Expand the <strong>Advanced Options</strong> section, and then enter the query below into the <strong>SQL Statement</strong> box to select the 20 most recently added rows in the “PolarBears” table. This is the query that the report will use to pull information from the database. When you’re done, click <strong>OK</strong>.</p>
<pre class="sql"><code>SELECT TOP 20 Id, CameraId, Latitude, Longitude, Url, Timestamp, FORMAT(Timestamp,&#39;MM/dd/yyyy h:mm:ss tt&#39;) AS TimestampLabel, IsPolarBear FROM dbo.PolarBears ORDER BY Timestamp DESC</code></pre>
<p><img src="images/2019-10-20-20-19-40.png" /></p></li>
<li><p>On the SQL Server database dialog, select <strong>Database</strong> from the menu on the left. Enter <strong>demouser</strong> for the user name and <strong>Demo@pass123</strong> for the password. Then click <strong>Connect</strong>.</p>
<p><img src="images/2019-10-20-20-23-55.png" /></p></li>
<li><p>Click <strong>Load</strong> to load the data into Power BI.</p></li>
</ol>
<p>After a short delay, Power BI will connect to the database and import a dataset using the query you provided. The next step is to create a report using that dataset.</p>
<h2 id="task-2-build-a-report-in-power-bi">Task 2: Build a report in Power BI</h2>
<p>Visualizations are the primary element that make up Power BI reports. In this task, you will use the Power BI report designer to create visuals from the database you connected to in the previous task, adjust filters and aggregates to refine the way the data is displayed, and format the visuals to produce compelling output.</p>
<ol type="1">
<li><p>On the Power BI Desktop canvas, click the <strong>Map</strong> icon in the “Visualizations” panel to add a map visual to the report.</p>
<p><img src="images/2019-10-20-20-32-55.png" /></p></li>
<li><p>Check the <strong>Latitude</strong> and <strong>Longitude</strong> boxes in the “Fields” panel to include these fields in the visual.</p>
<p><img src="images/2019-10-20-20-33-48.png" /></p></li>
<li><p>In the “Visualizations” panel, click the down arrow next to <strong>Average of Latitude</strong> and select <strong>Don’t summarize</strong> from the menu. Then do the same for <strong>Average of Longitude</strong>.</p>
<p><img src="images/2019-10-20-20-35-03.png" /></p></li>
<li><p>Return to the “Fields” panel and check the <strong>IsPolarBear</strong> box to add that field to the map. Then resize the map so that it looks something like this:</p>
<figure>
<img src="images/map-visual.png" alt="Resizing the map" /><figcaption>Resizing the map</figcaption>
</figure>
<p>Note that the number and location of the “bubbles” in your map will probably be different than what’s shown here.</p></li>
<li><p>Click in the empty area outside the map to deselect it. Then check the <strong>CameraId</strong>, <strong>IsPolarBear</strong>, and <strong>TimestampLabel</strong> boxes in the “Fields” panel to add a table visual containing those columns to the report.</p>
<figure>
<img src="images/table-visual-1.png" alt="Adding a table visual" /><figcaption>Adding a table visual</figcaption>
</figure></li>
<li><p>Deselect the table visual. Then check <strong>IsPolarBear</strong> and <strong>Latitude</strong> in the “Fields” panel to add another table visual, and click the <strong>Pie Chart</strong> icon in the “Visualizations” panel to convert the table into a pie chart.</p>
<p><img src="images/2019-10-20-20-38-21.png" /></p></li>
<li><p>Click the down arrow next to <strong>Average of Latitude</strong> and select <strong>Count</strong> from the menu to configure the pie chart to show a count of sightings and the proportion of sightings in which polar bears were detected.</p>
<figure>
<img src="images/pie-chart-visual.png" alt="Refining the pie-chart visual" /><figcaption>Refining the pie-chart visual</figcaption>
</figure></li>
<li><p>Deselect the pie-chart visual and click the <strong>Slicer</strong> icon to add a slicer to the report. Slicers provide a convenient means for filtering information in a Power BI report by narrowing the data shown in other visuals.</p>
<p><img src="images/2019-10-20-20-50-36.png" /></p></li>
<li><p>Select the <strong>IsPolarBear</strong> field in the “Fields” panel so the slicer shows checkboxes labeled “True” and “False.”</p>
<figure>
<img src="images/slicer-visual.png" alt="Refining the slicer" /><figcaption>Refining the slicer</figcaption>
</figure></li>
<li><p>Now resize and reposition the visuals to achieve a layout similar to this:</p>
<figure>
<img src="images/layout.png" alt="Adjusting the layout" /><figcaption>Adjusting the layout</figcaption>
</figure></li>
<li><p>With the report structure in place, the next task is to use some of Power BI’s rich formatting options to embellish the visuals. Start by selecting the map visual in the report designer. Then click the <strong>Format</strong> icon in the “Visualizations” panel.</p>
<p><img src="images/2019-10-20-20-51-43.png" /></p></li>
<li><p>Use the formatting controls in the “Visualizations” panel to make the following changes to the map visual:</p>
<ul>
<li><p>Under <strong>Legend</strong> set <strong>Legend Name</strong> to <strong>Polar bear sighted?</strong></p></li>
<li><p>Under <strong>Data colors</strong> set the color for <strong>False</strong> to 00FF00 (pure green) and the color for <strong>True</strong> to FF0000 (pure red)</p></li>
<li><p>Under <strong>Bubbles</strong> set the bubble size to <strong>30</strong></p></li>
<li><p>Under <strong>Map styles</strong> set the theme to <strong>Aerial</strong></p></li>
<li><p>Turn <strong>Title</strong> from on to <strong>off</strong></p></li>
</ul>
<p>Confirm that the resulting map looks something like this:</p>
<figure>
<img src="images/formatted-map-visual.png" alt="Formatted map visual" /><figcaption>Formatted map visual</figcaption>
</figure></li>
<li><p>Select the pie-chart visual and use the formatting controls in the “Visualizations” panel to make the following changes:</p>
<ul>
<li><p>Under <strong>Data colors</strong> set <strong>False</strong> to 00FF00 and <strong>True</strong> to FF0000</p></li>
<li><p>Under <strong>Detail labels</strong> change the label style to <strong>Data value, percent of total</strong></p></li>
<li><p>Under <strong>Title</strong> change the title text to <strong>Proportion of polar bear sightings</strong></p></li>
</ul>
<p>Confirm that the resulting pie-chart visual resembles this:</p>
<figure>
<img src="images/formatted-pie-chart-visual.png" alt="Formatted pie-chart visual" /><figcaption>Formatted pie-chart visual</figcaption>
</figure></li>
<li><p>Select the table visual and use the formatting controls in the “Visualizations” panel to make the following changes:</p>
<ul>
<li><p>Under <strong>Style</strong> change the style to <strong>Alternating rows</strong></p></li>
<li><p>Turn <strong>Title</strong> on, and change the title text to <strong>Camera activity</strong></p></li>
</ul>
<p>Confirm that the resulting table looks like this:</p>
<figure>
<img src="images/formatted-table-visual.png" alt="Formatted table visual" /><figcaption>Formatted table visual</figcaption>
</figure></li>
<li><p>Select the slicer visual and use the formatting controls in the “Visualizations” panel to make the following changes:</p>
<ul>
<li><p>Under <strong>Selection Controls</strong> set <strong>Single Select</strong> to <strong>off</strong></p></li>
<li><p>Turn <strong>Slicer header</strong> off</p></li>
<li><p>Turn <strong>Title</strong> on and set the title text to <strong>Show sightings that are:</strong></p></li>
</ul></li>
<li><p>Double-click <strong>Page 1</strong> in the bottom-left corner of the designer and change the report title to “Polar Bear Activity.”</p></li>
<li><p>Save the report by clicking <strong>Save</strong> in the upper-left corner of the page. Enter a report name such as <strong>Polar Bear Activity</strong></p></li>
</ol>
<p>The formatted report should resemble the one below. Feel free to embellish it further. You could, for example, add a title in a large font at the top of the report. Once you’re satisfied with the layout and content, it’s time to put it to work using a live data source.</p>
<figure>
<img src="images/formatted-report.png" alt="The formatted report" /><figcaption>The formatted report</figcaption>
</figure>
<h2 id="task-3-run-the-end-to-end-solution">Task 3: Run the end-to-end solution</h2>
<p>Now that the report is prepared in Power BI, your final task is to run the end-to-end solution that you built in this series of hands-on labs and check for polar bears!</p>
<ol type="1">
<li><p>Open the PolarBearDB database in the <a href="https://portal.azure.com">Azure Portal</a> and use the query editor to execute the following query and delete all rows from the “PolarBears” table:</p>
<pre class="sql"><code>DELETE FROM dbo.PolarBears</code></pre></li>
<li><p>Open the Stream Analytics job that you created in Exercise 2 in the Azure Portal and start the job.</p></li>
<li><p>Wait until the job is running. Then open a Command Prompt or terminal window and navigate to the project directory you created in Exercise 1. Use the following command to start the virtual cameras running:</p>
<pre><code>node run.js</code></pre></li>
<li><p>Return to the Power BI report click <strong>Refresh</strong> at the top of the page. Then refresh it again every 15 seconds or so. The report will refresh automatically every 15 minutes, but you can refresh it manually as often as you would like to update the visuals.</p>
<p><img src="images/2019-10-20-20-58-35.png" /></p></li>
<li><p>Confirm that red and green bubbles appear at various locations around the island. Red bubbles indicate the presence of polar bears, while green bubbles represent locations where photos were taken but no polar bears were detected. Locations that have a mixture of sightings will show red <em>and</em> green, as pictured below.</p>
<p><img src="images/report-in-action.png" alt="There be polar bears!" /> <em>There be polar bears!</em></p></li>
<li><p>Suppose you <em>only</em> wanted to show locations where polar bears were detected. Check the <strong>True</strong> box in the slicer visual. What happens in the map?</p></li>
<li><p>Continue running for a few minutes and refreshing the report once or twice a minute. Confirm that there are polar bears active on the island!</p></li>
<li><p>When you’re satisfied that the solution is working as intended, stop the cameras and stop the Stream Analytics job.</p></li>
</ol>
<p>You now have a report that shows, in near real-time, polar-bear activity on the island. If you have a <a href="https://powerbi.microsoft.com/blog/power-bi-pro-power-bi-premium-flexibility-to-choose-the-licensing-best-for-you-and-your-organization/">Power BI Pro or Power BI Premium</a> account, you can share the report with other Power BI users so they, too, can monitor polar-bear activity. For more information about sharing your work, see <a href="https://docs.microsoft.com/en-us/power-bi/service-how-to-collaborate-distribute-dashboards-reports" title="Share Power BI Dashboards and Reports">Share Power BI Dashboards and Reports</a>. Reports can also be viewed in the <a href="https://docs.microsoft.com/power-bi/mobile-apps-for-mobile-devices">Power BI mobile apps</a> so you can keep track of polar bears on your Windows, Android, or iOS device — even on an Apple watch!</p>
<h2 id="summary">Summary</h2>
<p>In this lab, you built a solution that feeds data from a simulated array of cameras into an <a href="https://azure.microsoft.com/services/iot-hub/">Azure IoT hub</a>, uploads photographs to <a href="https://azure.microsoft.com/services/storage/?v=16.50">Azure Storage</a>, processes the data using <a href="https://azure.microsoft.com/services/stream-analytics/">Azure Stream Analytics</a>, analyzes the photographs using the <a href="https://azure.microsoft.com/services/cognitive-services/custom-vision-service/">Custom Vision Service</a>, and visualizes the output using <a href="https://powerbi.microsoft.com/">Microsoft Power BI</a>. You also got first-hand experience using <a href="https://azure.microsoft.com/services/functions/">Azure Functions</a> and <a href="https://azure.microsoft.com/services/sql-database/">Azure SQL Database</a>. It’s a sophisticated solution, and one that has applications in the real world.</p>
<p>Once you’re finished using the solution, you should delete all the Azure services you deployed so they no longer charge to your subscription. To delete them, simply go to the Azure Portal and delete the “streaminglab-rg” resource group. That’s one of the many benefits of using resource groups: one simple action deletes the resource group and everything inside it. Once deleted, a resource group cannot be recovered, so make sure you’re finished with it before deleting it.</p>
<hr />
<p>Copyright 2018 Microsoft Corporation. All rights reserved. Except where otherwise noted, these materials are licensed under the terms of the MIT License. You may use them according to the license as is most appropriate for your project. The terms of this license can be found at https://opensource.org/licenses/MIT.</p>
</body>
</html>
